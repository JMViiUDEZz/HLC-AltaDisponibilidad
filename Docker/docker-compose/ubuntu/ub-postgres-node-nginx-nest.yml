version: "3"
services:
  dbEntradasATuAlcanceNest:
      image: postgres:14.3
      restart: always
      ports:
        - "${DB_PORT}:5432"
      environment:
        POSTGRES_USER: ${DB_USERNAME}
        POSTGRES_PASSWORD: ${DB_PASSWORD}
        POSTGRES_DB: ${DB_NAME}
      container_name: dbEntradasATuAlcanceNest
      volumes:
        - ./postgresEntradasATuAlcanceNest:/var/lib/postgresql/data
      networks: 
          net_postgres-node-nginx-nest:
              ipv4_address: 172.30.0.6
  postgres-node-nginx-nest:
    container_name: Postgres-node-nginx-nest
    image: ub-postgres-node-nginx-nest
    build: 
      context: ${DIR_DFILES}/ubuntu/postgres-node-nginx-nest
      dockerfile: ./ub-postgres-node-nginx-nest-dockerfile
      args: 
       - USUARIO=${USUARIO}
       - TZ=${TZ}
       - PASSWD=${PASSWD}
       - PNNN_PORT=${PNNN_PORT}
       - REPO_GITHUB=${REPO_GITHUB}
       - URL_GITHUB=${URL_GITHUB}
       - DB_HOST=${DB_HOST}
       - DB_NAME=${DB_NAME}
       - DB_USERNAME=${DB_USERNAME}
       - DB_PASSWORD=${DB_PASSWORD}
       - DB_PORT=${DB_PORT}
       - PORT=${PORT}
       - HOST_API=${HOST_API}
       - JWT_SECRET=${JWT_SECRET}
    env_file: 
      - ./.env
    ports: 
      - ${PNNN_PORT}:3000
    networks: 
      net_postgres-node-nginx-nest:
          ipv4_address: 172.30.0.7
    depends_on:
      - dbEntradasATuAlcanceNest
networks: 
  net_postgres-node-nginx-nest:
      ipam: 
          driver: default
          config: 
              - subnet: 172.30.0.0/16